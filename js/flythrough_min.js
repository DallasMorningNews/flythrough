!function(a){a.fn.flythrough=function(b){function h(a){f.children(".fly-button").unbind("click"),a.hasClass("play")===!0?(e++,i(),j()):(e--,i(),l())}function i(){0===e?f.children(".rewind").hide():e===c.frames.length-1?f.children(".play").hide():f.children(".fly-button").show()}function j(){g="play","waypoint"===c.frames[e].type&&(f.children(".image-overlay").fadeOut(250),f.children(".label").remove(),d[0].play()),e+1<c.frames.length&&"image"===c.frames[e+1].type&&a.preloadImages(c.frames[e+1].imagePath),p()}function k(){d[0].currentTime>=c.frames[e].end&&d[0].paused!==!0&&(d[0].pause(),n(),o(),m())}function l(){g="rewind","waypoint"===c.frames[e].type&&(f.children(".image-overlay").fadeOut(250),f.children(".label").remove(),n(),o(),d[0].currentTime=c.frames[e].end,m()),p()}function m(){f.children(".fly-button").bind("click",function(){return h(a(this))})}function n(){a(window).width()<=800&&f.children(".sat-credit").fadeIn(250).text(c.frames[e].satCredit),void 0!==c.frames[e].overlayHead&&f.find(".text-overlay h4").html(c.frames[e].overlayHead),void 0!==c.frames[e].overlayText&&f.find(".text-overlay p").html(c.frames[e].overlayText),void 0===c.frames[e].overlayHead&&void 0===c.frames[e].overlayText||f.children(".text-overlay").fadeIn(250)}function o(){void 0!==c.frames[e].labels&&a.each(c.frames[e].labels,function(a,b){var d="";d+="<span class='label' style='top: "+c.frames[e].labels[a].y+"; left: "+c.frames[e].labels[a].x+";'>",d+=c.frames[e].labels[a].text,d+="</span>",f.append(d)})}function p(){"image"===c.frames[e].type&&(f.children(".sat-credit").fadeOut(250),f.children(".text-overlay").fadeOut(250),f.children(".label").remove(),f.find(".image-overlay img").attr("src",c.frames[e].imagePath).attr("alt",c.frames[e].cutline),void 0!==c.frames[e].cutline&&f.find(".image-overlay .cutline").html(c.frames[e].cutline),"play"===g&&"image"!==c.frames[e-1].type?f.children(".image-overlay").fadeIn(250):"rewind"===g&&"image"!==c.frames[e+1].type&&f.children(".image-overlay").fadeIn(250),d[0].currentTime=c.frames[e].end,m())}var c=a.extend({frames:[]},b);0===c.frames.length&&console.error("Frames must be an array with at least one object.");var d=this.children(".fly-video"),e=0,f=this,g="";return a.preloadImages=function(){a("<img />").attr("src",arguments[0])},i(),d[0].controls=!1,d[0].addEventListener("timeupdate",k,!1),this.children(".fly-button").bind("click",function(){return h(a(this))}),this.find(".title-button").click(function(){f.find(".title-card").remove(),d[0].currentTime=c.frames[e].end,void 0!==c.frames[e].satCredit&&f.children(".sat-credit").text(c.frames[e].satCredit),f.find(".play").addClass("button-highlight"),setTimeout(function(){f.find(".play").removeClass("button-highlight")},2e3),n(),o(),p()}),this}}(jQuery);
