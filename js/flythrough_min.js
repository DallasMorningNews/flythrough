!function(e){e.fn.flythrough=function(a){function t(e){u.children(".flyButton").unbind("click"),e.hasClass("play")===!0?(h++,r(),i()):(h--,r(),l())}function r(){0===h?u.children(".rewind").hide():h===c.frames.length-1?u.children(".play").hide():u.children(".flyButton").show()}function i(){y="play","waypoint"===c.frames[h].type&&(u.children(".imageOverlay").fadeOut(250),u.children(".label").remove(),o[0].play()),h+1<c.frames.length&&"image"===c.frames[h+1].type&&e.preloadImages(c.frames[h+1].imagePath),m()}function n(){o[0].currentTime>=c.frames[h].end&&o[0].paused!==!0&&(o[0].pause(),d(),f(),s())}function l(){y="rewind","waypoint"===c.frames[h].type&&(u.children(".imageOverlay").fadeOut(250),u.children(".label").remove(),d(),f(),o[0].currentTime=c.frames[h].end,s()),m()}function s(){u.children(".flyButton").bind("click",function(){return t(e(this))})}function d(){e(window).width()<=800&&u.children(".satCredit").fadeIn(250).text(c.frames[h].satCredit),void 0!==c.frames[h].overlayHead&&u.find(".textOverlay h4").html(c.frames[h].overlayHead),void 0!==c.frames[h].overlayText&&u.find(".textOverlay p").html(c.frames[h].overlayText),(void 0!==c.frames[h].overlayHead||void 0!==c.frames[h].overlayText)&&u.children(".textOverlay").fadeIn(250)}function f(){void 0!==c.frames[h].labels&&e.each(c.frames[h].labels,function(e,a){var t="";t+="<span class='label' style='top: "+c.frames[h].labels[e].y+"; left: "+c.frames[h].labels[e].x+";'>",t+=c.frames[h].labels[e].text,t+="</span>",u.append(t)})}function m(){"image"===c.frames[h].type&&(u.children(".satCredit").fadeOut(250),u.children(".textOverlay").fadeOut(250),u.children(".label").remove(),u.find(".imageOverlay img").attr("src",c.frames[h].imagePath).attr("alt",c.frames[h].cutline),void 0!==c.frames[h].cutline&&u.find(".imageOverlay .cutline").html(c.frames[h].cutline),"play"===y&&"image"!==c.frames[h-1].type?u.children(".imageOverlay").fadeIn(250):"rewind"===y&&"image"!==c.frames[h+1].type&&u.children(".imageOverlay").fadeIn(250),o[0].currentTime=c.frames[h].end,s())}var c=e.extend({frames:[]},a);0===c.frames.length&&console.error("Frames must be an array with at least one object.");var o=this.children(".flyVideo"),h=0,u=this,y="";return e.preloadImages=function(){e("<img />").attr("src",arguments[0])},r(),o[0].controls=!1,o[0].addEventListener("timeupdate",n,!1),this.children(".flyButton").bind("click",function(){return t(e(this))}),this.find(".titleButton").click(function(){u.find(".titleCard").remove(),o[0].currentTime=c.frames[h].end,void 0!==c.frames[h].satCredit&&u.children(".satCredit").text(c.frames[h].satCredit),u.find(".play").addClass("buttonHighlight"),setTimeout(function(){u.find(".play").removeClass("buttonHighlight")},2e3),d(),f(),m()}),this}}(jQuery);
